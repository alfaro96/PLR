FROM python:3.6-slim

# Need to install git for version control and gcc
# and g++ to compile the files generated by Cython
RUN apt-get update
RUN apt-get install -y git gcc g++ make

# Install the requirements needed to build
# and test the package (including linting)
COPY requirements/*.txt /req/
RUN cat /req/*.txt > /req/requirements.txt
RUN pip install --upgrade pip; \
    pip install -r /req/requirements.txt

# Create a new user to avoid that the
# container is run in privileged mode
ARG USERNAME=scikit-lr
ENV HOME /home/$USERNAME
RUN useradd -ms /bin/bash $USERNAME
USER $USERNAME
RUN mkdir -p $HOME/workspace
WORKDIR $HOME/workspace

# Define the local directory where the
# package is going to be installed, since
# the user has not super-user priviligies
ENV PYTHONPATH $HOME/.local

CMD /bin/bash
